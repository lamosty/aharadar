# Get list of staged files before formatting
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(js|jsx|ts|tsx|json|css)$' || true)

# Run format on the whole repo to fix any lint issues
pnpm format 2>/dev/null || true

# Re-stage any files that were originally staged (in case format modified them)
if [ -n "$STAGED_FILES" ]; then
  echo "$STAGED_FILES" | xargs -r git add
fi

# Now run lint-staged (should have nothing to fix since we just formatted)
pnpm exec lint-staged
