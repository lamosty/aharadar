# Copy this file to `.env` or `.env.local` and fill in secrets.
# Do NOT commit your `.env` (it is gitignored). `.env.example` is safe to commit.

# -----------------------------------------------------------------------------
# Core runtime (required for CLI)
# -----------------------------------------------------------------------------

APP_ENV=local
APP_TIMEZONE=UTC

# Matches docker-compose.yml defaults (Postgres + Redis)
DATABASE_URL=postgres://aharadar:aharadar_dev_password@localhost:5432/aharadar
REDIS_URL=redis://localhost:6379

# Budgets (required)
MONTHLY_CREDITS=10000
DEFAULT_TIER=normal

# Budgets (optional)
DAILY_THROTTLE_CREDITS=

# Optional auth (used by API/admin surfaces when enabled)
ADMIN_API_KEY=dev-api-key

# -----------------------------------------------------------------------------
# Scheduler (worker)
# -----------------------------------------------------------------------------

# Scheduler tick interval in minutes (default: 5)
SCHEDULER_TICK_MINUTES=5

# Max windows to backfill per topic per tick (default: 6)
# Prevents runaway backfill when cursor is far behind
SCHEDULER_MAX_BACKFILL_WINDOWS=6

# Minimum window duration in seconds (default: 60)
# Windows shorter than this are skipped
SCHEDULER_MIN_WINDOW_SECONDS=60

# Worker health probe URL (default: http://localhost:9091/health)
WORKER_HEALTH_URL=http://localhost:9091/health

# -----------------------------------------------------------------------------
# Ops Dashboard Links (for Admin Ops page)
# -----------------------------------------------------------------------------

# Local defaults (started via pnpm start)
OPS_GRAFANA_URL=http://localhost:3002/d/aharadar-overview/aharadar-overview?orgId=1&refresh=30s
OPS_PROMETHEUS_URL=http://localhost:9090
OPS_QUEUE_DASHBOARD_URL=http://localhost:3101
OPS_LOGS_URL=

# -----------------------------------------------------------------------------
# Digest Plan Hard Caps
# -----------------------------------------------------------------------------

# Maximum digest items (hard cap, default: 300)
DIGEST_MAX_ITEMS_HARD_CAP=300

# Maximum triage LLM calls per run (hard cap, default: 2000)
DIGEST_TRIAGE_MAX_CALLS_HARD_CAP=2000

# Maximum deep summary LLM calls per run (hard cap, default: 60)
DIGEST_DEEP_SUMMARY_MAX_CALLS_HARD_CAP=60

# Maximum candidate pool size (hard cap, default: 5000)
DIGEST_CANDIDATE_POOL_HARD_CAP=5000

# API server port (default: 3001)
API_PORT=3001

# Queue UI port (default: 3101)
QUEUE_UI_PORT=3101

# -----------------------------------------------------------------------------
# User API Key Encryption
# -----------------------------------------------------------------------------

# Encryption key for user API keys (32 bytes, hex encoded)
# Generate with: openssl rand -hex 32
APP_ENCRYPTION_KEY=

# Allow fallback to system API keys when user has none configured
ALLOW_SYSTEM_KEY_FALLBACK=true

# -----------------------------------------------------------------------------
# LLM (OpenAI-compatible Responses API) — used for triage today
# -----------------------------------------------------------------------------

OPENAI_API_KEY=

# Prefer base URL; code appends `/v1/responses` for LLM calls (and `/v1/embeddings` for embeddings).
OPENAI_BASE_URL=https://api.openai.com

# Optional explicit endpoint override (full URL to `/v1/responses`)
OPENAI_ENDPOINT=

# Model selection
OPENAI_MODEL=
OPENAI_TRIAGE_MODEL=
OPENAI_TRIAGE_MODEL_LOW=
OPENAI_TRIAGE_MODEL_NORMAL=
OPENAI_TRIAGE_MODEL_HIGH=

# Triage controls (optional)
OPENAI_TRIAGE_MAX_OUTPUT_TOKENS=250
OPENAI_TRIAGE_MAX_INPUT_CHARS=4000
OPENAI_TRIAGE_MAX_TITLE_CHARS=240
OPENAI_TRIAGE_MAX_CALLS_PER_RUN=
OPENAI_TRIAGE_REASONING_EFFORT=

# Credits estimate (optional)
OPENAI_CREDITS_PER_1K_INPUT_TOKENS=
OPENAI_CREDITS_PER_1K_OUTPUT_TOKENS=
OPENAI_TRIAGE_CREDITS_PER_1K_INPUT_TOKENS=
OPENAI_TRIAGE_CREDITS_PER_1K_OUTPUT_TOKENS=

# -----------------------------------------------------------------------------
# Anthropic API (Claude) — alternative LLM provider
# -----------------------------------------------------------------------------

# Anthropic API key (optional - enables Claude models)
ANTHROPIC_API_KEY=

# Model selection
ANTHROPIC_MODEL=claude-sonnet-4-20250514
ANTHROPIC_TRIAGE_MODEL=
ANTHROPIC_TRIAGE_MODEL_LOW=claude-3-5-haiku-latest
ANTHROPIC_TRIAGE_MODEL_NORMAL=claude-sonnet-4-20250514
ANTHROPIC_TRIAGE_MODEL_HIGH=claude-sonnet-4-20250514

# Provider selection (global or per-task)
# Set to "anthropic" to use Claude, "openai" for OpenAI (default: openai)
LLM_PROVIDER=openai
LLM_TRIAGE_PROVIDER=
LLM_DEEP_SUMMARY_PROVIDER=
LLM_ENTITY_EXTRACT_PROVIDER=
LLM_SIGNAL_PARSE_PROVIDER=

# -----------------------------------------------------------------------------
# Claude Subscription Mode (experimental) — personal use only
# -----------------------------------------------------------------------------

# Enable subscription mode (uses Claude Code login credentials)
# Requires: `claude login` to have been run on this machine
# WARNING: For personal use only - not allowed for SaaS products per Anthropic ToS
CLAUDE_USE_SUBSCRIPTION=false

# Model selection for subscription mode (defaults to Anthropic model settings)
CLAUDE_MODEL=
CLAUDE_TRIAGE_MODEL=

# Extended thinking for triage (improves quality, uses more quota)
CLAUDE_TRIAGE_THINKING=false

# Quota protection (hourly limits to prevent subscription exhaustion)
CLAUDE_CALLS_PER_HOUR=100
CLAUDE_SEARCHES_PER_HOUR=20
CLAUDE_THINKING_TOKENS_PER_HOUR=50000

# -----------------------------------------------------------------------------
# Codex Subscription Mode (experimental) — personal use only
# -----------------------------------------------------------------------------

# Enable subscription mode (uses Codex CLI login credentials)
# Requires: `codex` CLI to be installed and logged in with ChatGPT subscription
# Works with ChatGPT Plus ($20/mo), Pro ($200/mo), Business, Edu, Enterprise
# WARNING: For personal use only
CODEX_USE_SUBSCRIPTION=false

# Model selection for subscription mode (defaults to OpenAI model settings)
CODEX_MODEL=
CODEX_TRIAGE_MODEL=

# Quota protection (hourly limits to prevent subscription exhaustion)
CODEX_CALLS_PER_HOUR=50

# -----------------------------------------------------------------------------
# Embeddings (OpenAI-compatible) — used for embed stage + semantic search
# -----------------------------------------------------------------------------

OPENAI_EMBED_MODEL=
OPENAI_EMBED_MODEL_LOW=
OPENAI_EMBED_MODEL_NORMAL=
OPENAI_EMBED_MODEL_HIGH=

# Optional explicit endpoint override (full URL to `/v1/embeddings`).
# If omitted and OPENAI_BASE_URL is set, it is derived automatically.
OPENAI_EMBED_ENDPOINT=

# Embed stage controls (optional)
OPENAI_EMBED_MAX_ITEMS_PER_RUN=100
OPENAI_EMBED_BATCH_SIZE=16
OPENAI_EMBED_MAX_INPUT_CHARS=8000

# Credits estimate (optional)
OPENAI_EMBED_CREDITS_PER_1K_INPUT_TOKENS=
# Legacy alias (accepted by code)
OPENAI_EMBED_CREDITS_PER_1K_TOKENS=

# -----------------------------------------------------------------------------
# Signal connector (X/Twitter search via Grok) — optional
# -----------------------------------------------------------------------------

# Required for signal sources to fetch
SIGNAL_GROK_API_KEY=
# Alternate name supported by code
GROK_API_KEY=

# Preferred: base URL (code appends `/v1/responses`)
SIGNAL_GROK_BASE_URL=
# Alternate name supported by code
GROK_BASE_URL=

# Optional explicit endpoint override (full URL to `/v1/responses`)
SIGNAL_GROK_ENDPOINT=

# Optional tuning
SIGNAL_GROK_MODEL=
SIGNAL_GROK_MAX_OUTPUT_TOKENS=
SIGNAL_GROK_ENABLE_X_SEARCH_TOOL=1

# Budget/caps (optional)
SIGNAL_MAX_SEARCH_CALLS_PER_RUN=
SIGNAL_CREDITS_PER_CALL=

# -----------------------------------------------------------------------------
# SEC EDGAR connector — optional
# -----------------------------------------------------------------------------

# User-Agent for SEC EDGAR API requests (required for compliance)
# Should include app name and contact info
SEC_EDGAR_USER_AGENT=AhaRadar/1.0 (contact@example.com)

# -----------------------------------------------------------------------------
# Congress Trading connector (Quiver Quantitative) — optional
# -----------------------------------------------------------------------------

# Quiver Quantitative API key for Congress trading data
# Sign up free at: https://www.quiverquant.com/
# Free tier: ~100 requests/day
QUIVER_API_KEY=

# -----------------------------------------------------------------------------
# Options Flow connector (Unusual Whales) — optional
# -----------------------------------------------------------------------------

# Unusual Whales API key for options flow data
# Sign up at: https://unusualwhales.com/
UNUSUAL_WHALES_API_KEY=

# -----------------------------------------------------------------------------
# Market Sentiment connector (Finnhub) — optional
# -----------------------------------------------------------------------------

# Finnhub API key for social sentiment data
# Sign up free at: https://finnhub.io/
# Free tier: 60 API calls/minute
FINNHUB_API_KEY=

# -----------------------------------------------------------------------------
# Telegram connector — optional
# -----------------------------------------------------------------------------

# Telegram Bot API token for fetching channel messages
# Create a bot via @BotFather on Telegram: https://t.me/BotFather
# Note: Bot must be added as admin to target channels to receive channel posts
TELEGRAM_BOT_TOKEN=
